// Generated by CoffeeScript 1.6.3
var Q, cli, path;

path = require('path');

Q = require('q');

cli = require('../cli');

module.exports = function(program) {
  return program.command('screenshot [names] [output]').description('save screenshots for virtual machines').action(function(names, output, command) {
    return cli.fail(Q.fcall(function() {
      if ((names != null) && (output == null) && names.match(/^[\.\~\/]/)) {
        output = names;
        names = null;
      }
      if (output == null) {
        output = process.cwd();
      }
      return cli.find(names, 'running').found().then(function(vms) {
        var screenshots, vm, _fn, _i, _len;
        screenshots = [];
        _fn = function(vm) {
          var file;
          file = path.join(output, "" + vm.name + ".png");
          return screenshots.push(Q.fcall(function() {
            return vm.screenshot(file);
          }));
        };
        for (_i = 0, _len = vms.length; _i < _len; _i++) {
          vm = vms[_i];
          _fn(vm);
        }
        return Q.all(screenshots);
      });
    }));
  });
};
