// Generated by CoffeeScript 1.6.3
var Q, cli;

Q = require('q');

cli = require('../cli');

module.exports = function(program) {
  return program.command('rearm [names]').description('rearm virtual machines').option('-E, --no-expired', 'rearm the even if not expired').action(function(names, command) {
    var msg;
    msg = command.expired ? 'no matching expired virtual machines found' : void 0;
    return cli.fail(cli.find(names, '!missing').maybeWhere(command.expired, 'expired').found(msg).then(function(vms) {
      return cli.dsl(vms).where('!running').then(function(stopped) {
        return cli.dsl(stopped).all(function(vm) {
          return vm.start(true);
        }).then(function() {
          return cli.dsl(vms).all(function(vm) {
            return vm.rearm();
          }).then(function() {
            return cli.dsl(stopped).all(function(vm) {
              return vm.stop();
            });
          });
        });
      });
    }));
  });
};
