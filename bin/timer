#! /bin/bash

# Simple wrapper around notification commands and sleep to send messages after
# a set amount of time has passed.

script_name=$(basename "$0")
usage_msg="Send a notification after a certain amount of time has passed.

Usage: $script_name <message> <minutes> [<seconds>]"

if [ "$1" = '--help' ]; then
    echo "$usage_msg"

    exit
elif [ $# -lt 2 ] || [ $# -gt 3 ]; then
    echo "$usage_msg" >&2

    exit 2
fi

is-int () {
    [[ "$1" =~ ^[0-9]+$ ]]

    return $?
}

if ! is-int "$2"; then
    echo "$2 is not an integer!" >&2

    exit 1
fi

if [ ! -z "$3" ] && ! is-int "$3"; then
    echo "$3 is not an integer!" >&2

    exit 1
fi


seconds="$(( $2 * 60 ))"

if [ $# -eq 3 ]; then
    seconds="$(( $seconds + $3 ))"
fi

applescript="display notification \"$1\" with title \"Time's up\" "
$(sleep "$seconds" && osascript -e "$applescript") &
