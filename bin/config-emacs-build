#! /bin/bash

# My configuration for building Emacs from source for use on OS X. Largely done
# so that I can have automatic resizing of images to fit in a frame when
# reading email, which only works if ImageMagick support is compiled into your
# build (and in turn that doesn't just happen in the Emacs for OS X builds:
# https://github.com/caldwell/build-emacs/issues/1).
#
# Note that when building from a Git checkout, you'll need to run
# `./autogen.sh` first, per the CONTRIBUTE document in the project's
# repository.
#
# Largely ripped from this post on Reddit:
#
# https://www.reddit.com/r/emacs/comments/bclyyc/building_emacs_from_source_on_macos/
#
# Note that the second instance of CPPFLAGS is a workaround for brew not
# including libxml2's include files in /usr/local/include.

./configure --with-ns \
            --with-imagemagick \
            --with-modules \
            --enable-silent-rules \
            PKG_CONFIG_PATH=/opt/local/lib/pkgconfig \
            LDFLAGS="-L/usr/local/lib" \
            LDFLAGS="-L/usr/lib" \
            CPPFLAGS="-I/usr/local/include" \
            CPPFLAGS="-I/usr/local/Cellar/libxml2/2.9.7/include/libxml2" \
            CC=clang OBJC=clang CFLAGS="-g -O2"
